Задание 1
Вы анализируете динамику обращения пользователей в отдел клиентского сервиса по телефону. У каждого пользователя есть возможность оценить обращение после коммуникации по пятибалльной шкале. Каждое 100 обращение проходит внутреннюю проверку качества по критериям: грамотность, вежливость и скорость обработки обращения. По результатам оценки каждого критерия по пятибалльной шкале выводится среднее арифметическое – внутренняя оценка качества. За год средняя оценка пользователей упала на 10%, а внутренняя оценка выросла на 2%.
Ваша задача:
•	выдвинуть гипотезы, почему такое могло произойти;
•	предложить варианты проверки каждой из гипотез;
•	предложить план действий в случае подтверждения каждой гипотезы.

Ответы
1)	
 
Гипотеза: Арифметическая или логическая ошибка в расчетах.
Проверка: Проверить самостоятельно или предложить рассчитать коллеге.
План действий: Исправить ошибку.

2)	 
Гипотеза: Возможно, такую оценку в 2% мы получили случайно, это могло произойти, например, если за год было очень мало обращений.
Проверка: Рассчитать статистическую значимость внутренней оценки.
План действий: Если мы не смогли отвергнуть гипотезу о случайности нашей выборки, то стоит, если существуют записи обращений, проверить большее количество обращений, чем каждое 100.

3)	 
Гипотеза: Выборка не репрезентативна.
Проверка: Что значит каждое 100 обращение? Каждое 100 по времени обращение? Или, возможно, берётся пул обращений и по каким-то критериям выбирается каждое 100 обращение. 
Нужно проверить по каким критериям выбирается каждое 100 обращение. Включаются ли в выборку обращения, равномерно распределенные по времени суток, по специалистам, по характеристикам обращений, по локациям пользователей, по полу и др.
План действий: Сообщить руководству о некачественном анализе при формировании внутренней оценки. Если существуют записи обращений, то попросить проверить каждое 100 по времени или сделать случайную выборку каждого 100 обращения из базы.

4)	
Гипотеза: В базе данных, куда подгружается информация по обращением клиентов, есть какая-либо ошибка.
Проверка: Проверить логику загрузки данных из прикладного ПО, которое принимает оценки пользователей, в базу данных по всем оценкам, которую как раз мы анализируем. Каждое 100 обращение также может анализироваться в прикладном ПО.
План действий: Самостоятельно или с привлечением компетентных сотрудников исправить логику загрузки данных.

5)	
Гипотеза: По 3-м критериям берётся среднее арифметическое. Но для пользователей в течение года значимость каждого критерия может изменится. Например, им стала больше всего важна скорость обработки обращения.
Проверка: Проверить значимость каждого критерия для клиента можно, например, используя множественную регрессию. Нужно проверить значимость каждого критерия как за исследуемый период, так и за период, с которым сравниваем.
План действий: Опираясь на сравнения 2-х периодов изменить долю вклада во внутреннюю оценку каждого из критериев.

6)	
Гипотеза: Изменилась система проверки качества.
Проверка: Узнать, как осуществляется проверка качества. Возможно, субъективно руководителем отдела, тогда проверить не сменился ли руководитель, так ли он оценивает звонки как раньше. Для этого передать руководителю для оценки записи разговоров предыдущего периода.
План действий: Изменить оценку предыдущего периода для корректного сравнения показателей внутренней оценки.

7)	
Гипотеза: Возможно, общее качество работы сотрудников других отделов ухудшилось, а это отражается на общую оценку звонка. Например, по регламенту работники клиентского сервиса говорят, что такая-то проблему будет устранена в течение часа, а она техническими специалистами не устраняется, клиенты снова звонят и им опять отвечают, что будет проблема устранена в течение часа, а она не устраняется.
Проверка: Проанализировать на что жалуются клиенты, как изменилось качество работы других отделов. Проверить, если есть более подробные данные о звонке, были ли повторные звонки клиентов по одним и тем же вопросам и как они их оценивают. 
План действий: Если повторные звонки клиенты оценивают низко, то это может свидетельствовать о том, что неэффективно работают сотрудники других подразделений, поэтому для сравнения двух периодов можно исключить из анализа эти повторные звонки.

8)	
Гипотеза: Увеличилось среднее время ожидания клиентов в очереди, которое влияет на оценку звонка. 
Проверка: Проверить на сколько изменилось среднее время ожидания по сравнению с предыдущим периодом.
План действий: Сравнить звонки в двух периодах (отчетном и предыдущем). Сделать это можно по логике, описанной ниже. 
Например, среднее время ожидания в предыдущем периоде 5 мин., средняя оценка пользователей 4, в отчетном периоде среднее время ожидания 10 мин., средняя оценка пользователей 3,6. Теперь нужно взять выборку звонков из отчётного периода, в котором будет аналогичное распределение доли оценок как в предыдущем периоде, т.е. среднее время ожидания в выборке будет 5 мин. Вот если мы увидим, что средняя оценка пользователей будет больше, чем 3,6, тогда можно говорить о влиянии среднего времени ожидания. Можно будет вводить поправочный коэффициент для того, чтобы сравнить с предыдущем периодом, если нам нужно оценить именно качество работы непосредственно работников клиентского сервиса.

9)	
Гипотеза: Возможно, наших 3-х критериев внутренней оценки недостаточно. У пользователей в отчётном периоде появились вопросы другого качества, например, они стали более сложные и пользователям стало тяжело их формулировать, поэтому работники сервисного центра должны проявлять активность, задавать наводящие вопросы, быть инициативными. Активность могла не подразумеваться в каком-либо из 3-х критериев (в частности грамотности). 
Проверка: Проверить корреляцию оценок пользователей и внутренних оценок за предыдущий и отчётный период. 
План действий: Если корреляция в отчетном периоде уменьшилась, то это связано, с тем, что наши внутренние критерии не объективно отражают качество звонка. Совместно с компетентными сотрудниками провести «мозговой штурм» на предмет включения/изменения критериев внутренней оценки


Задание 2
Вывести топ-3 менеджера в каждом из офисов по количеству звонков за январь 2020.
Запрос должен возвращать таблицу вида OFFICE | RATING | CNT_CALLS.
Под рейтингом понимается «место» менеджера по количеству звонков в своем офисе (менеджер с самым большим количеством звонков по офису должен иметь рейтинг 1, следующий за ним 2 и т.д.).

/*
 Мой скрипт подходит для PostgreSQL.
 Таблица для задания не приложена, поэтому предположу, что она содержит как минимум следующие поля:
 id_calls, id_employee, office, date_call, где id_calls это PK
  */

-- Можно создать таблицу по следующему скрипту:

create table employee_calls(
id_calls serial primary key,
id_employee integer not null,
office varchar(255) not null,
date_call date not null
);



/*
Для решения задачи я использовал 2 CTE запроса, где второй ссылается на результаты первого запроса.
Далее запрос, ссылаясь на второй CTE запрос, выводит требуемые данные.
 */

with employee_calls_agg as (
	select
	id_employee
	,office
	,count(id_calls) as cnt_calls
	from employee_calls
	where 1=1
	and extract(year from date_call) = 2020
	and extract(month from date_call) = 1
	group by 
	id_employee
	,office
	having count(id_calls) > 0  -- данный фильтр нужен, чтобы в выборку не попадали сотрудники, не осуществляющие звонки в январе 2020.
	),
calls_rating as (
	select
	id_employee
	,office
	,cnt_calls
	,dense_rank() over(partition by office order by cnt_calls desc) as rating 
	/*
	 Оконная функция dense_rank() больше всего подходит, т.к. она выставляет ранг без пропусков и 
	 для сотрудников с одинаковыми количествами звонков она выставляет одинаковый рейтинг.
	 */
	from employee_calls_agg
)
select
--id_employee,
office
,rating
,cnt_calls
from calls_rating
where rating <= 3 -- в связи с тем, что использовалась функция dense_rank(), может быть выведено не 3 сотрудника в каждом офисе, а больше, зато "честно" будут отражены успехи сотрудников.
order by 
office
,rating;
